# Obsidian_KindleNotes_To_Zotero (iPad / Pyto MVP)

Sync Kindle/Amazon highlight markdown files from an Obsidian vault **into Zotero** as **notes** under the matching **book** item—entirely on an iPad using **Pyto**.

- ✅ Works offline on iPad (no Mac/PC required)  
- ✅ Adds notes to **existing** Zotero book items if found  
- ✅ Creates missing books and places them in your **Books** collection (configurable)  
- ✅ **Idempotent**: duplicate-prevention via a local sent-log  
- ✅ Handles nested folders; scans recursively  

---

## Contents

- [What it does](#what-it-does)  
- [Requirements](#requirements)  
- [Quick start (iPad-only)](#quick-start-ipad-only)  
- [Configuration](#configuration)  
- [How it works](#how-it-works)  
- [Duplicate prevention](#duplicate-prevention)  
- [Collections (“Books”)](#collections-books)  
- [Troubleshooting](#troubleshooting)  
- [Security: API key](#security-api-key)  
- [Advanced: macOS/Windows/Linux](#advanced-macoswindowslinux)  
- [FAQ](#faq)  
- [Roadmap](#roadmap)  
- [License](#license)  

---

## What it does

- Parses each Obsidian `.md` file (one book per file, Kindle-style export).  
- **Files are expected to be generated by the [Kindle Highlights Obsidian plugin](https://github.com/hadynz/obsidian-kindle-plugin)**, which exports your Kindle notes and highlights into a consistent Markdown format.  
- Extracts:
  - **Title** (first `# H1`)
  - **Author** (lines like `Author: ...`)
  - **Highlights** (blocks separated by `---`, with optional `Location`/`Note`)
- For each book:
  - **Search** Zotero by **title**:
    - If found → attach new notes to the same item.
    - If not found → create a **book** item (in the `Books` collection) and attach notes.
- Keeps a `.sent_highlights.json` log so re-runs don’t create duplicates.

---

## Requirements

On **iPad**:
- **Pyto** (Python IDE for iOS)  
- **Obsidian** with the [Kindle Highlights plugin](https://github.com/hadynz/obsidian-kindle-plugin) installed (this plugin generates the `.md` files the script understands)  
- **Zotero** account + **API key** with write access  

Optional (for contributing/desktop use):
- Python 3.10+
- `requests` library

---

## Quick start (iPad-only)

1. **Get your Zotero API key & User ID**  
   - Create an API key: [https://www.zotero.org/settings/keys](https://www.zotero.org/settings/keys) (must allow write access).  
   - Find your **User ID** on that same page.

2. **Export your Kindle highlights to Obsidian**  
   - Install the [Kindle Highlights plugin](https://github.com/hadynz/obsidian-kindle-plugin) in Obsidian.  
   - Use it to pull your Kindle highlights into a vault folder. Each book will be a `.md` file in the format this script expects.

3. **Prepare your notes folder**  
   - In the iPad **Files** app, **copy** the folder containing those `.md` files into:
     ```
     On My iPad / Pyto / AmazonNotes
     ```
   - *(Reason: iOS sandboxing often blocks direct access to iCloud “Obsidian” from Pyto. Using Pyto’s own folder avoids permission errors.)*

4. **Create the script**  
   - In Pyto, create `obsidian_to_zotero.py` and paste the script from this repo.  
   - At the top of the file, set:
     ```python
     ZOTERO_API_KEY = "YOUR_KEY"
     ZOTERO_USER_ID = "YOUR_USER_ID"
     OBSIDIAN_VAULT_PATH = str(Path.home() / "Documents" / "AmazonNotes")
     ```
     *(You can rename “AmazonNotes” if you used a different folder.)*

5. **First run: Dry run**  
   - Run the script in Pyto.  
   - Choose **“Yes (Dry Run)”** when prompted.  
   - You should see output like:
     ```
     Vault path: /var/mobile/Containers/…/Documents/AmazonNotes
     exists: True is_dir: True
     Found 17 markdown files (recursive).
     [DRY RUN] (Collection 'Books' will be created or used)
     Processing: How to Take Smart Notes (Sönke Ahrens) — 23 highlights
     [DRY RUN] Would create book: How to Take Smart Notes in collection: <key or None>
     [DRY RUN] Would add note: <first highlight>...
     ```

6. **Live run**  
   - Re-run script, choose **“No (Send to Zotero)”**.  
   - Books will be created (if needed), added to **Books** collection, and notes pushed.

---

## Configuration

```python
# Required
ZOTERO_API_KEY = "..."       # write-enabled Zotero API key
ZOTERO_USER_ID = "..."       # your Zotero user id (or group id if USE_GROUP=True)

# Set to True to target a Zotero Group library instead of personal library:
USE_GROUP = False

# The collection where books should go (created automatically if missing)
COLLECTION_NAME = "Books"

# The folder with your Obsidian markdown files (inside Pyto’s sandbox on iPad)
OBSIDIAN_VAULT_PATH = str(Path.home() / "Documents" / "AmazonNotes")
