# Obsidian_KindleNotes_To_Zotero (iPad / Pyto MVP)

Sync Kindle/Amazon highlight markdown files from an Obsidian vault **into Zotero** as **notes** under the matching **book** item — entirely on an iPad using **Pyto**.

- ✅ Works fully offline on iPad (no Mac/PC required)  
- ✅ Adds notes to **existing** Zotero book items if found  
- ✅ Creates missing books and places them in your **Books** collection (configurable)  
- ✅ **Idempotent**: duplicate-prevention via a local sent-log  
- ✅ **Resume support** — skip books already processed in earlier live runs  
- ✅ **Per-title filtering** — run only on specific books  
- ✅ **Batch limiting** — process N books at a time for safer testing  
- ✅ Handles nested folders; scans recursively  

> **Note:** The `.md` files **must** be generated by the [Kindle Highlights Obsidian plugin](https://github.com/hadynz/obsidian-kindle-plugin). This ensures a consistent, parseable format for title, author, and highlight blocks.

---

## Contents

- [What it does](#what-it-does)  
- [Requirements](#requirements)  
- [Quick start (iPad-only)](#quick-start-ipad-only)  
- [Configuration](#configuration)  
- [Quick usage examples](#quick-usage-examples)  
- [How it works](#how-it-works)  
- [Duplicate prevention](#duplicate-prevention)  
- [Resume mode](#resume-mode)  
- [Filtering and batch limiting](#filtering-and-batch-limiting)  
- [Collections (“Books”)](#collections-books)  
- [Troubleshooting](#troubleshooting)  
- [Security: API key](#security-api-key)  
- [Advanced: macOS/Windows/Linux](#advanced-macoswindowslinux)  
- [FAQ](#faq)  
- [Roadmap](#roadmap)  
- [License](#license)  

---

## What it does

- Parses each Obsidian `.md` file (one book per file, Kindle-style export).
- Extracts:
  - **Title** (first `# H1`)
  - **Author** (`Author: ...` line)
  - **Highlights** (blocks separated by `---`, with optional `Location` and `Note`)
- For each book:
  - **Search** Zotero by **title** and author:
    - If found → attach new notes to the existing item.
    - If not found → create a **book** item (in the `Books` collection) and attach notes.
- Keeps a `.sent_highlights.json` log so re-runs don’t create duplicates.
- Supports:
  - Resuming where you left off
  - Targeting specific titles
  - Limiting runs to a fixed batch size

---

## Requirements

On **iPad**:
- **Pyto** (Python IDE for iOS)  
- **Obsidian** with the [Kindle Highlights plugin](https://github.com/hadynz/obsidian-kindle-plugin) installed (to generate `.md` files in the correct format)  
- **Zotero** account + **API key** with write access  

Optional (for contributing/desktop use):
- Python 3.10+
- `requests` library

---

## Quick start (iPad-only)

1. **Get your Zotero API key & User ID**  
   - Create an API key: [https://www.zotero.org/settings/keys](https://www.zotero.org/settings/keys) (must allow write access).  
   - Find your **User ID** on that same page.

2. **Export your Kindle highlights to Obsidian**  
   - Install the [Kindle Highlights plugin](https://github.com/hadynz/obsidian-kindle-plugin) in Obsidian.  
   - Use it to pull your Kindle highlights into a vault folder. Each book will be a `.md` file in the format this script expects.

3. **Prepare your notes folder**  
   - In the iPad **Files** app, **copy** the folder containing those `.md` files into:
     ```
     On My iPad / Pyto / AmazonNotes
     ```
   - *(Reason: iOS sandboxing often blocks direct access to iCloud “Obsidian” from Pyto. Using Pyto’s own folder avoids permission errors.)*

4. **Create `secrets.json`**  
   - In the same folder as the script, create:
     ```json
     {
       "ZOTERO_API_KEY": "YOUR_KEY",
       "ZOTERO_USER_ID": "YOUR_USER_ID",
       "USE_GROUP": false
     }
     ```

5. **Create the script**  
   - In Pyto, create `obsidian_to_zotero.py` and paste the latest script from this repo.

6. **First run: Dry run**  
   - Set `DRY_RUN = True` at the top of the script.  
   - Run it — the script will show what it *would* send without touching Zotero.

7. **Live run**  
   - Set `DRY_RUN = False`.  
   - When prompted, type **SEND NOW** to confirm.  
   - Books will be created (if needed), added to the `Books` collection, and notes pushed.

---

## Configuration

```python
# Required: in secrets.json
ZOTERO_API_KEY = "..."       # write-enabled Zotero API key
ZOTERO_USER_ID = "..."       # your Zotero user id (or group id if USE_GROUP=true)

# In-script settings:
COLLECTION_NAME = "Books"    # Zotero collection to store books
OBSIDIAN_VAULT_PATH = str(Path.home() / "Documents" / "AmazonNotes")

# Resume support:
RESUME_ENABLED = True        # Skip books already completed in previous live runs

# Filtering & batch limiting:
ONLY_TITLES = []             # e.g. ["smart notes", "foundation"]; [] = all books
BATCH_LIMIT = 0              # e.g. 5 = stop after 5 books; 0 = no limit
```
---

## Quick usage examples

**Run all books** (default):

```python
ONLY_TITLES = []
BATCH_LIMIT = 0
```
**Run only one book**

```python
ONLY_TITLES = ["smart notes"]  # case-insensitive substring match
BATCH_LIMIT = 0
```

**Test the first five books**

```python
ONLY_TITLES = []
BATCH_LIMIT = 5
```

**Run only 'foundation' books and limit it to two**

```python
ONLY_TITLES = ["foundation"]
BATCH_LIMIT = 2
```

**How it works**
	1. Loads Zotero API credentials from secrets.json.
	2. Reads .md files from OBSIDIAN_VAULT_PATH (recursively).
	3. Parses each file for title, author, and highlights.
	4. Looks for a matching Zotero book item:
		1. Found → adds missing notes.
		2. Not found → creates new book in COLLECTION_NAME, then adds notes.
	5. Records sent highlights in .sent_highlights.json for de-duplication and resume support.

⸻

**Duplicate prevention**

The .sent_highlights.json log also tracks individual highlights sent to Zotero.
If a highlight’s text/note/location matches a previously sent one, it will not be sent again — even if you re-run the script.

⸻

**Resume mode**

When RESUME_ENABLED = True, the script remembers which books it finished in live runs and skips them in future runs.
Safe for large libraries or interrupted runs.

⸻

**Filtering and batch limiting**
- ONLY_TITLES: list of substrings to match in book titles (case-insensitive).
- BATCH_LIMIT: integer; process at most N matching books in one run.

You can combine both for targeted batch updates.

⸻

**Collections (“Books”)**

The script will create (or reuse) a Zotero collection named Books by default.
Change COLLECTION_NAME to target a different one.

⸻

**Troubleshooting**
- Permission errors on iPad usually mean Pyto can’t read from iCloud.
	- Copy your notes into On My iPad / Pyto.
- If Dry run still creates items, make sure DRY_RUN = True and you’re using the latest script.
- If a book doesn’t appear in Zotero:
	- Check title/author formatting in the .md file.
	- Try removing its entry from .sent_highlights.json and re-run.

⸻

**Security: API key**
- Store your key only in secrets.json.
- Never commit it to GitHub.
- The key must have write permission to the Zotero library you’re targeting.

⸻

**Advanced: macOS/Windows/Linux**

You can run this script on desktop Python 3.10+ with the requests library installed.
Adjust OBSIDIAN_VAULT_PATH to your local vault folder path.

⸻

**FAQ**

**Q: Will this overwrite my Zotero data?**
A: No, it only creates new book items (if missing) and appends notes.

**Q: Can I target a Zotero group library?**
A: Yes — set "USE_GROUP": true in secrets.json and ZOTERO_USER_ID to the group ID.

⸻

**Roadmap**
- Optional HTML-to-Markdown conversion for notes
- Configurable note formatting
- GUI picker for vault path on iPad

⸻

**License**

MIT — do whatever you want, but no warranty.
